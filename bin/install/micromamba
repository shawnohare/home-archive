#! /usr/bin/env sh
# NOTE: This is a POSIX version of the micromamba installer script
# that doesn't modify RC files.

ARCH=$(uname -m)
OS=$(uname)

if [ -e "${HOME}/.local/bin/micromamba" ]; then
    echo "micromamba already exists."
    exit 0
fi

# Determine platform and arch.
if [ "$OS" = "Linux" ]; then
	PLATFORM="linux"
	if [ "$ARCH" = "aarch64" ]; then
		ARCH="aarch64";
	elif [ $ARCH = "ppc64le" ]; then
		ARCH="ppc64le";
	else
		ARCH="64";
	fi
fi

if [ "$OS" = "Darwin" ]; then
	PLATFORM="osx";
	if [ "$ARCH" = "arm64" ]; then
		ARCH="arm64";
	else
		ARCH="64"
	fi
fi

mkdir -p ~/.local/bin
curl -Ls "https://micro.mamba.pm/api/micromamba/${PLATFORM}-${ARCH}/latest" | tar -xvj -C ~/.local/bin/ --strip-components=1 bin/micromamba
